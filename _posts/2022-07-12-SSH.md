# SSH

간단하게 SSH에 대해 알아보는 실습을 해보겠습니다.

<br><br><br>

### 목적지 port 바꾸기

우선 centOS6를 Client로 XP를 Server로 활용하면서 사용해 보겠습니다.

SSH의 기본 *port 번호는* *22번입니다.*

그럼 SSH의 *port 번호를* 바꾸면 제대로 실행이 되는지 한번 *알아보겠습니다.*

<br><br><br>

우선 SSH의 정보가 담긴 파일은 `/etc/ssh`에 있습니다.

<br><br><br>

*port 번호* 정보가 담긴 파일에 접근합니다.

![2022-07-12-02포트번호변경](../images/2022-07-12-SSH/2022-07-12-02포트번호변경.PNG)

<br><br><br>

port 번호를 22000으로 바꿔 보겠습니다.

![2022-07-12-01포트번호변경](../images/2022-07-12-SSH/2022-07-12-01포트번호변경.PNG)

port번호 변경사항을 재적용 시킵니다.

<br><br><br>

![2022-07-12-03포트번호변경](../images/2022-07-12-SSH/2022-07-12-03포트번호변경.PNG)

<br><br><br>

이제 Server에 가서 확인해 보겠습니다.

![2022-07-12-04포트번호변경후 XP에서접속해보기](../images/2022-07-12-SSH/2022-07-12-04포트번호변경후 XP에서접속해보기.PNG)

![2022-07-12-05포트번호변경후 XP에서접속해보기성공](../images/2022-07-12-SSH/2022-07-12-05포트번호변경후 XP에서접속해보기성공.PNG)

*port 번호를* 바꿔도 그 바꾼 번호를 통해 접속한다면 문제없이 접속이 가능하다는 것을 알 수 있습니다.

<br><br><br>

### root 로그인을 차단

다음은 root 사용자를 차단하고 접속이 되는지 확인해 보겠습니다.

<br><br><br>

root 사용자를 차단하고 재적용 합니다.

![2022-07-12-02포트번호변경](../images/2022-07-12-SSH/2022-07-12-02포트번호변경-16576128628517.PNG)

![2022-07-12-06루트사용자차단하기](../images/2022-07-12-SSH/2022-07-12-06루트사용자차단하기.PNG)

<br><br><br>

![2022-07-12-06루트사용자차단하고 재적용](../images/2022-07-12-SSH/2022-07-12-06루트사용자차단하고 재적용.PNG)

<br><br><br>

Server로 가서 확인해 보겠습니다.

![2022-07-12-06루트사용자차단하기xp에서확인root로그인불가](../images/2022-07-12-SSH/2022-07-12-06루트사용자차단하기xp에서확인root로그인불가.PNG)

![2022-07-12-06루트사용자차단하기xp에서확인ktest로그인성공](../images/2022-07-12-SSH/2022-07-12-06루트사용자차단하기xp에서확인ktest로그인성공.PNG)

root 사용자는 *로그인이 안 되지만* 다른 *사용자는 로그인이 되는 것을* 확인해 볼 수 있습니다.



<br><br><br><br><br><br>



### SSH 버전 변경 테스트

SSHv2에서 SSHv1로 바꿔서 실행해 보겠습니다.

![2022-07-12-02포트번호변경](../images/2022-07-12-SSH/2022-07-12-02포트번호변경-165761363451412.PNG)

![2022-07-12-07-프로토콜변경](../images/2022-07-12-SSH/2022-07-12-07-프로토콜변경.PNG)

![2022-07-12-07-프로토콜변경후 재적용](../images/2022-07-12-SSH/2022-07-12-07-프로토콜변경후 재적용.PNG)


<br><br><br><br><br><br>


Server로 가서 확인해 보겠습니다.

SSH버전을 1로 바꾸고 접속 하겠습니다.

![2022-07-12-08-서버에서 확인하기1](../images/2022-07-12-SSH/2022-07-12-08-서버에서 확인하기1.PNG)

![2022-07-12-09-서버에서 확인하기2](../images/2022-07-12-SSH/2022-07-12-09-서버에서 확인하기2.PNG)

접속에 성공 했습니다. SSH 버전2로도 한번 접속 해보겠습니다.

![2022-07-12-10-서버에서 확인하기3](../images/2022-07-12-SSH/2022-07-12-10-서버에서 확인하기3.PNG)

![2022-07-12-11-서버에서 확인하기4](../images/2022-07-12-SSH/2022-07-12-11-서버에서 확인하기4.PNG)

접속에 실패했습니다.

SSH는 다른 버전으로는 접속이 되지 않는다를 알 수 있습니다.

<br><br><br>

이제 Server에 설치되어 있는 Wireshark로 SSH에 대해 좀 더 자세히 알아보도록 하겠습니다.

<br><br><br>

SSH의 기본 동작 방식입니다.

![2022-07-12-22-SSH기본연결방식](../images/2022-07-12-SSH/2022-07-12-22-SSH기본연결방식.PNG)

<br><br><br>

SSHv1의 TCP 연결 생성부터 Wireshark로 알아 보겠습니다.

![2022-07-12-12-tcp연결생성](../images/2022-07-12-SSH/2022-07-12-12-tcp연결생성.PNG)

<br><br><br>

SSH version 협상 부분입니다.

![2022-07-12-13-ssh버전협상](../images/2022-07-12-SSH/2022-07-12-13-ssh버전협상.PNG)

<br><br><br>

key 교환 부분입니다.

![2022-07-12-14-키교환1](../images/2022-07-12-SSH/2022-07-12-14-키교환1.PNG)

![2022-07-12-14-키교환2](../images/2022-07-12-SSH/2022-07-12-14-키교환2.PNG)

<br><br><br>

SSHv2를 Wireshark로 알아 보겠습니다.

<br><br><br>

SSH version 협상 부분입니다.

![2022-07-12-16-sshv2버전협상](../images/2022-07-12-SSH/2022-07-12-16-sshv2버전협상.PNG)

<br><br><br>

key 교환 부분입니다.

![2022-07-12-17-sshv2키교환](../images/2022-07-12-SSH/2022-07-12-17-sshv2키교환.PNG)

<br><br><br>

암호화 통신 / 암호화된 Data 송 / 수신 부분입니다.

![2022-07-12-18-sshv2암호화데이터교환](../images/2022-07-12-SSH/2022-07-12-18-sshv2암호화데이터교환.PNG)

<br><br><br>

이번에는 Protocol 1,2를 동시에 사용해 보겠습니다.

![2022-07-12-21-프로토콜1,2로변경](../images/2022-07-12-SSH/2022-07-12-21-프로토콜1,2로변경.PNG)

<br><br><br>

동시에 SSHv1은 version1.5 SSHv2는 version2.0이 실행되는 것을 위의 Wireshark로 확인이 가능합니다.

Protocol 1,2를 동시에 사용하면

![2022-07-12-19-sshv1,2 버전1.9나옴](../images/2022-07-12-SSH/2022-07-12-19-sshv1,2 버전1.9나옴.PNG)

version이 1.99로 실행되는 것을 확인 할 수 있습니다.


<br><br><br><br><br><br>


이제 위에서 실습했던 것들을 토대로 내용을 조금 더 추가하여 SSH server 구성 실습을 해 보겠습니다.



```
SSH Server 구성 실습
- CentOS 6  구성 조건
 IP : 172.16.0.110/24 (그대로) 
 standalone 모드로 설정 (그대로) 

 port번호 : 10022번으로 설정
 root 로그인 금지
 로그인 대기 시간 : 30초
 로그인 시도 횟수 : 2
 배너 정보 변경 : Hello KH SSH Server  - 접속할때 나오면 메시지 
```

천천히 하나씩 진행하도록 하겠습니다.

IP와 standalone은 기본 설정 그대로이기에 넘어가도록 하겠습니다.

SSH의 설정은 `/etc/ssh/sshd_config` 로 들어가서 설정하면 됩니다.

<br><br><br>

port 번호 설정 입니다.

![2022-07-12-23-02과제](../images/2022-07-12-SSH/2022-07-12-23-02과제.PNG)

root 로그인 금지 설정 입니다.

![2022-07-12-23-03과제](../images/2022-07-12-SSH/2022-07-12-23-03과제.PNG)

로그인 대기 시간 30초로 설정 입니다.

![2022-07-12-23-08과제](../images/2022-07-12-SSH/2022-07-12-23-08과제.PNG)

로그인 시도 횟수 2회로 설정 입니다.

![2022-07-12-23-05과제](../images/2022-07-12-SSH/2022-07-12-23-05과제.PNG)

배너정보 변경 설정 입니다.

배너는 경로를 설정 해야 되기 때문에 밖에서 파일을 하나 만들고 Hello KH SSH Server 내용을 넣어 주겠습니다.

![2022-07-12-23-10과제](../images/2022-07-12-SSH/2022-07-12-23-10과제.PNG)

![2022-07-12-23-11과제](../images/2022-07-12-SSH/2022-07-12-23-11과제.PNG)

![2022-07-12-23-09과제](../images/2022-07-12-SSH/2022-07-12-23-09과제-165761948602537.PNG)

<br><br><br>

root 로그인 금지 설정 확인 입니다.

접속시 Hello KH SSH Server 뜨는 것도 같이 확인 가능 합니다.

![2022-07-12-23-12과제root로그인불가](../images/2022-07-12-SSH/2022-07-12-23-12과제root로그인불가.PNG)

다른 사용자로 로그인 되는지 확인해 보겠습니다.

![2022-07-12-23-13과제ktest로그인성공](../images/2022-07-12-SSH/2022-07-12-23-13과제ktest로그인성공.PNG)

로그인 대기시간 30초 설정 확인 입니다.

![2022-07-12-23-14과제로그인대기시간30초](../images/2022-07-12-SSH/2022-07-12-23-14과제로그인대기시간30초.PNG)

로그인 시도 횟수 2회로 설정 확인 입니다.

![2022-07-12-23-15과제 로그인횟수2회](../images/2022-07-12-SSH/2022-07-12-23-15과제 로그인횟수2회.PNG)



<br><br><br><br><br><br>



마지막으로 SCP에 대해서 알아 보겠습니다.

SCP란 SSH를 이용해 파일을 복사하는 명령어 입니다.

우선 172.16.0.121의 CentOS7에 hi라는 내용이 담긴 파일을 하나 만들고 172.16.0.205의 다른 CentOS7에 복사해 보겠습니다.

<br><br><br>

우선 2개의 서버들이 서로 통신이 되는지 확인해 보겠습니다.

![2022-07-12-01핑확인1](../images/2022-07-12-SSH/2022-07-12-01핑확인1.PNG)

![2022-07-12-02핑확인2](../images/2022-07-12-SSH/2022-07-12-02핑확인2.PNG)

정상적으로 핑이 가는 것을 확인 했습니다.

다음으로 파일을 하나 만들어 보겠습니다.

![2022-07-12-03파일하나만들기](../images/2022-07-12-SSH/2022-07-12-03파일하나만들기.PNG)

<br><br><br>

이제 SCP명령어를 한번 확인해 보겠습니다.

![2022-07-12-04scp확인](../images/2022-07-12-SSH/2022-07-12-04scp확인.PNG)

<br><br><br>

SCP명령어를 실행 해보겠습니다.

![2022-07-12-05scp실행](../images/2022-07-12-SSH/2022-07-12-05scp실행.PNG)

파일이 복사가 되었습니다. 제대로 복사가 되었는지 확인하러 가보겠습니다.

![2022-07-12-06미니에서확인](../images/2022-07-12-SSH/2022-07-12-06미니에서확인.PNG)

파일이 잘 복사 되었습니다.

<br><br><br>

지금까지 SSHD에 대해서 알아 봤습니다.

실습 마무리 하겠습니다~~
