# PHP

<br>

PHP란 C언어를 기반으로 만들어진  서버 측에서 실행된 ServerSideScript입니다.

<br>

##### 기본 설정

php 설치

mariaDB 설치

vsftpd 설치하고 root 접근 가능하도록 허용

<br>

mariaDB 설치

yum -y install을 사용해서 mariaDB를 설치 해주시면 됩니다.

<br>

root 접근 가능하도록 허용

![2022-08-29-01환경설정](../images/2022-08-29-php/2022-08-29-01환경설정.PNG)

![2022-08-29-03환경설정](../images/2022-08-29-php/2022-08-29-03환경설정.PNG)

![2022-08-29-04환경설정](../images/2022-08-29-php/2022-08-29-04환경설정.PNG)

위의 2개 파일에 들어가서 root만 주석처리 해주시면 됩니다.

<br>

알 드라이브 사용하여 접속

![2022-08-29-02환경설정](../images/2022-08-29-php/2022-08-29-02환경설정.PNG)

알 드라이브를 설치 하시고 root 사용자로 접속 해주시면 됩니다.

<br>

PHP 설치

![2022-08-29-05php설치](../images/2022-08-29-php/2022-08-29-05php설치.PNG)

httpd도 같이 설치 해주도록 하겠습니다.

<br>

PHP 기본 설정

![2022-08-29-06php설정](../images/2022-08-29-php/2022-08-29-06php설정.PNG)

![2022-08-29-07php설정](../images/2022-08-29-php/2022-08-29-07php설정.PNG)

PHP로 해석해라 라는 부분 입니다.

![2022-08-29-08php설정](../images/2022-08-29-php/2022-08-29-08php설정.PNG)

Error 메시지 출력과 관련된 부분 입니다.

![2022-08-29-09php설정](../images/2022-08-29-php/2022-08-29-09php설정.PNG)

undefined index 관련 부분 입니다.

<br>

PHP 파일 만들기

![2022-08-29-10php파일만들기](../images/2022-08-29-php/2022-08-29-10php파일만들기.PNG)

<br>

PHP 파일 옮기기

![2022-08-29-11php파일옮기기](../images/2022-08-29-php/2022-08-29-11php파일옮기기.PNG)

알 드라이브를 이용하여 PHP 파일을 /var/www/html에 옮겨 줍니다.

<br>

host pc로 확인

![2022-08-29-12확인](../images/2022-08-29-php/2022-08-29-12확인.PNG)

<br>

### PHP 자료형

##### PHP 변수

![2022-08-29-13php변수](../images/2022-08-29-php/2022-08-29-13php변수.PNG)

<br>

host pc에서 확인

![2022-08-29-14php변수 확인](../images/2022-08-29-php/2022-08-29-14php변수 확인.PNG)

<br>

<br>

<br>

##### PHP 자료형 : 정수

![2022-08-29-16정수](../images/2022-08-29-php/2022-08-29-16정수.PNG)

<br>

확인

![2022-08-29-15정수확인](../images/2022-08-29-php/2022-08-29-15정수확인.PNG)

INT3은 최대값을 넘어서 실수로 표현됨.

<br>

<br>

<br>

##### PHP 자료형 : 실수

![2022-08-29-17실수](../images/2022-08-29-php/2022-08-29-17실수.PNG)

<br>

확인

![2022-08-29-18실수](../images/2022-08-29-php/2022-08-29-18실수.PNG)

<br>

<br>

<br>

##### PHP 자료형 : 문자열

![2022-08-29-19문자](../images/2022-08-29-php/2022-08-29-19문자.PNG)

<br>

확인

![2022-08-29-20문자확인](../images/2022-08-29-php/2022-08-29-20문자확인.PNG)

<br>

<br>

<br>

##### PHP 자료형 : 상수

![2022-08-29-21상수](../images/2022-08-29-php/2022-08-29-21상수.PNG)

<br>

확인

![2022-08-29-22상수확인](../images/2022-08-29-php/2022-08-29-22상수확인.PNG)

<br>

<br>

<br>

##### PHP 자료형 :  NULL

![2022-08-29-23널](../images/2022-08-29-php/2022-08-29-23널.PNG)

<br>

확인

![2022-08-29-24널](../images/2022-08-29-php/2022-08-29-24널.PNG)

마지막 echo "$x"는 출력되지 않음이 확인 가능 합니다.

<br>

<br>

<br>

### PHP 와 DB

##### PHP를 이용한 MariaDB 연결

패키지 설치

![2022-08-29-30설치](../images/2022-08-29-php/2022-08-29-30설치.PNG)

<br>

DB파일 만들기

![2022-08-29-25db](../images/2022-08-29-php/2022-08-29-25db.PNG)

<br>

DB파일 불러오기

![2022-08-29-26db파일](../images/2022-08-29-php/2022-08-29-26db파일.PNG)

<br>

DB 내용 확인

![2022-08-29-28보드테이블](../images/2022-08-29-php/2022-08-29-28보드테이블.PNG)

![2022-08-29-29멤버](../images/2022-08-29-php/2022-08-29-29멤버.PNG)

<br>

연결 해보기

![2022-08-29-31연결성공](../images/2022-08-29-php/2022-08-29-31연결성공.PNG)

![2022-08-29-33연결성공](../images/2022-08-29-php/2022-08-29-33연결성공.PNG)

![2022-08-29-34연결실패](../images/2022-08-29-php/2022-08-29-34연결실패.PNG)

![2022-08-29-32연결실패](../images/2022-08-29-php/2022-08-29-32연결실패.PNG)

연결실패 code는 password에서 마지막에 d를 빼서 일부러 틀리게 해놨습니다.

위의 예시들은 구버전용 입니다. 현재 centos7는 다른 방식이 있습니다. 지금부터 최신버전으로 예시를 다시 해 보겠습니다.

<br>

DB연결 성공

![2022-08-29-37db연결성공](../images/2022-08-29-php/2022-08-29-37db연결성공.PNG)

![2022-08-29-38db연결성공](../images/2022-08-29-php/2022-08-29-38db연결성공.PNG)

<br>

DB연결 실패

![2022-08-29-39db연결실패](../images/2022-08-29-php/2022-08-29-39db연결실패.PNG)

![2022-08-29-40db연결실패](../images/2022-08-29-php/2022-08-29-40db연결실패.PNG)

DB연결이 성공하면 con 변수안에 들어있는 DB정보들이 출력 되지만 연결에 실패하면 아무것도 안나오고 DB 선택 실패가 출력되는 모습 입니다.

<br>

<br>

<br>

##### PHP 를 이용한 MariaDB 에 SQL 문 전송  I - create 

![2022-08-29-41SQL](../images/2022-08-29-php/2022-08-29-41SQL.PNG)

![2022-08-29-42SQL](../images/2022-08-29-php/2022-08-29-42SQL.PNG)

성공하면 이렇게 TRUE가 출력이 되고 실패할시 FALSE가 출력 됩니다.

<br>

<br>

<br>

##### PHP 를 이용한 MariaDB 에 SQL 문 전송  II - insert 

![2022-08-29-43인서트](../images/2022-08-29-php/2022-08-29-43인서트.PNG)

<br>

확인

![2022-08-29-44인서트](../images/2022-08-29-php/2022-08-29-44인서트.PNG)

![2022-08-29-45인서트](../images/2022-08-29-php/2022-08-29-45인서트.PNG)

<br>

<br>

<br>

##### PHP 를 이용한 MariaDB 에 SQL 문 전송  II - select

#####  ![2022-08-29-46셀렉트](../images/2022-08-29-php/2022-08-29-46셀렉트.PNG)

<br>

확인

![2022-08-29-47셀렉트](../images/2022-08-29-php/2022-08-29-47셀렉트.PNG)

여태까지 해왔던 방식대로 select를 해보려 했으나 오류가 뜨는 모습 입니다. select는 다른 방식으로 출력을 해야 합니다.

<br>

select 출력 code

![2022-08-29-48셀렉트](../images/2022-08-29-php/2022-08-29-48셀렉트.PNG)

만약 여기서 while문을 사용하지 않는다면 1개만 출력되고 끝나는 상황이 발생하기에 while문을 사용 했습니다.

<br>

확인

![2022-08-29-49셀렉트](../images/2022-08-29-php/2022-08-29-49셀렉트.PNG)

<br>

추가

![2022-08-29-50셀렉트](../images/2022-08-29-php/2022-08-29-50셀렉트.PNG)

<br>

확인

![2022-08-29-51셀렉트](../images/2022-08-29-php/2022-08-29-51셀렉트.PNG)

만약 while문을 쓰지 않았다면 첫번째 행만 출력되고 새로 삽입한 2번째 행은 출력되지 않았을 것입니다. 이러한 이유로 while문을 사용 했습니다.

<br>

<br>

<br>

##### WebTest 웹사이트 구조

![2022-08-29-59사이트구조](../images/2022-08-29-php/2022-08-29-59사이트구조.PNG)

이렇게 구조를 만들어 보겠습니다.

<br>

일단 기본적인 파일들을 만들어 두겠습니다.

index.php

<!doctype html>
<html>
    <!-- head 부분 -->
    <head> 
        <!-- 상단 title -->
        <title>Web Test Site</title>
        <!-- CSS Style 지정 -->
        <link rel="stylesheet" href="style_contents.css" type="text/css">
    </head>
    <body>
        <!-- 화면 상단 header 부분 -->
            <iframe src="head.php" id="bodyFrame" name="body" width="100%" frameborder="0"></iframe>
        <!-- 화면 하단 body 부분 -->
        <div id="main_contents" class="contents">
            <h1>
            <?php 
                session_start();
                if($_SESSION[nickname])
                    echo $_SESSION[nickname]."님 ";
            ?>환영합니다~!!^^</h1>
            <font color="#323232" size="4em">
            웹 해킹을 공부하고 싶은데 연습할 곳이 없으시다구요?<br>
            실제 사이트에 연습하다가는 <strong>!!철컹철컹!!</strong> 아시죠?<br>
            이곳은 Web Hacking 연습을 위한 Test 사이트 입니다.<br>
            이곳에서는 마음껏 연습하세요~!!^^<br>
            </font>
        </div>
    </body>
</html>

<br>

dbconn.php

![2022-08-29-60dcorn](../images/2022-08-29-php/2022-08-29-60dcorn.PNG)

<br>

head.php

![2022-08-29-61head](../images/2022-08-29-php/2022-08-29-61head.PNG)

![2022-08-29-62head](../images/2022-08-29-php/2022-08-29-62head.PNG)

<br>

style_contents.css

![2022-08-29-64style](../images/2022-08-29-php/2022-08-29-64style.PNG)

![2022-08-29-65style](../images/2022-08-29-php/2022-08-29-65style.PNG)

<br>

style_head.css

![2022-08-29-63style](../images/2022-08-29-php/2022-08-29-63style-16619301257856.PNG)

이렇게 기본적인 파일들을 먼저 구성해 두고 시작 하겠습니다.

<br>

<br>

<br>

##### member

<br>

###### 로그인 과정

<br>

http 분석

![2022-08-29-56로그인정보](../images/2022-08-29-php/2022-08-29-56로그인정보.PNG)

![2022-08-29-58멤버파일](../images/2022-08-29-php/2022-08-29-58멤버파일.PNG)

![2022-08-29-66로그인](../images/2022-08-29-php/2022-08-29-66로그인.PNG)

로그인을 하게 되면 위의 member_login 파일이 정보를 전송 해 주는 방식 입니다. 첫번째 사진은 그 모습을 Wireshark로 잡은 모습 입니다.

<br>

회원정보 테이블 추가

![2022-08-29-54사용자추가](../images/2022-08-29-php/2022-08-29-54사용자추가.PNG)

![2022-08-29-55사용자조회](../images/2022-08-29-php/2022-08-29-55사용자조회.PNG)

이렇게 가상의 회원을 1명 추가해 보고 로그인 성공 실패를 분석 해 보겠습니다.

<br>

member_login_check.php 파일을 하나 만들어 보겠습니다.

![2022-08-29-67멤버체크](../images/2022-08-29-php/2022-08-29-67멤버체크.PNG)

이렇게 파일을 만들고 실행을 해 보겠습니다.

<br>

파일 실행

![2022-08-29-68실패](../images/2022-08-29-php/2022-08-29-68실패.PNG)

로그인 실패라고 출력이 됩니다.

SQL준비 부분에서 u_pass 부분이 틀렸기 때문 입니다.

이번엔 로그인 성공이 출력 되도록 실패한 부분을 주석처리 하고 실행 해보시면 됩니다.

![2022-08-29-69성공](../images/2022-08-29-php/2022-08-29-69성공.PNG)

로그인 성공이 출력 됩니다.

<br>

member_login_check.php

![2022-08-29-70멤버체크](../images/2022-08-29-php/2022-08-29-70멤버체크.PNG)

![2022-08-29-71멤버체크](../images/2022-08-29-php/2022-08-29-71멤버체크.PNG)

이렇게 파일을 완성 하였습니다. 사용자를 추가하여 로그인을 해 보겠습니다.

<br>

사용자 추가

![2022-08-29-72사용자추가](../images/2022-08-29-php/2022-08-29-72사용자추가.PNG)

<br>

로그인 시도

![2022-08-29-73로그인](../images/2022-08-29-php/2022-08-29-73로그인.PNG)

![2022-08-29-74로그인성공](../images/2022-08-29-php/2022-08-29-74로그인성공.PNG)

로그인에 성공 하였습니다.

<br>

로그인 성공, 실패시 팝업창이 출력 되도록 JAVAscript를 이용하여 만들어 보겠습니다.

<br>

member_login_check.php

![2022-08-29-75스크립트](../images/2022-08-29-php/2022-08-29-75스크립트.PNG)

script를 조금 추가해 주었습니다.

alert가 팝업창을 생성해주는 명령어 입니다.

<br>

팝업창 확인

![2022-08-29-76스크립트](../images/2022-08-29-php/2022-08-29-76스크립트.PNG)

![2022-08-29-77스크립트](../images/2022-08-29-php/2022-08-29-77스크립트.PNG)

팝업창이 생성 되었습니다.

<br>

history.back();

로그인이 실패하든 성공하든 저희가 보던 사이트는 원래 페이지로 돌아가는 기능이 있습니다.

지금 추가할 history.back(); 명령어가 그러한 기능을 해줍니다.

![2022-08-29-78스크립트](../images/2022-08-29-php/2022-08-29-78스크립트.PNG)

<br>

확인

![2022-08-29-79확인](../images/2022-08-29-php/2022-08-29-79확인.PNG)

로그인 전 입니다.

![2022-08-29-80확인](../images/2022-08-29-php/2022-08-29-80확인.PNG)

확인을 누르고 확인 해보시면

![2022-08-29-81확인](../images/2022-08-29-php/2022-08-29-81확인.PNG)

이렇게 전에 있던 페이지로 돌아가게 됩니다.

전에 있던 페이지로 돌아는 가지만 로그인 성공했던 기록을 가지고 돌아가는 것이 아닙니다. 이제부터는 그 기록을 가지고 페이지로 돌아가도록 해 보겠습니다.

<br>

location.replace();

![2022-08-29-85로그인](../images/2022-08-29-php/2022-08-29-85로그인.PNG)

location.replace(); 명령어를 사용해 주시면 됩니다.

history.back은 전에 실행됫던 페이지로 가지만 정보를 가지고 가지 않았습니다.

location.replace는 전에 설정한 페이지로 이동하면서 정보를 가지고 갑니다.

<br>

확인

![2022-08-29-82로그인](../images/2022-08-29-php/2022-08-29-82로그인.PNG)

![2022-08-29-83로그인](../images/2022-08-29-php/2022-08-29-83로그인.PNG)

여기서 확인을 눌러 주시면

![2022-08-29-84로그인](../images/2022-08-29-php/2022-08-29-84로그인.PNG)

index.php로 넘어가는 모습 입니다.

<br>

