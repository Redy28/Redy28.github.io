#####  Directory Listing 취약점

![2022-11-01-01디렉](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-01디렉.jpg)

<br>

취약점 확인 해보기

![2022-11-01-04멤버](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-04멤버.jpg)

이렇게 디렉터리 안의 구조가 다 보입니다.

<br>

취약한 이유

```
웹서버의 하위 디렉터리 별로 index.html 이 없으면 디렉터리내의 모든 내용이 보여집니다
[root@localhost html]# cd /var/www/html/member/
[root@localhost member]# ls
member_info.php         member_login_check.php  member_nick_change.php
member_info_change.php  member_logout.php       member_register.php
member_login.php        member_nick.php         member_register_ok.php

[root@localhost member]# echo member /var/www/html/member/index.html
member /var/www/html/member/index.html
[root@localhost member]# echo member > /var/www/html/member/index.html
[root@localhost member]# ls
index.html              member_login.php        member_nick.php         member_register_ok.php
member_info.php         member_login_check.php  member_nick_change.php
member_info_change.php  member_logout.php       member_register.php
만들고 다시 확인
```

![2022-11-01-03멤버](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-03멤버.jpg)

<br>

디렉터리 설정파일 확인

![2022-11-01-05설정파일](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-05설정파일.jpg)

<br>

방어

```
vim /etc/httpd/conf/httpd.conf

331     #Options Indexes FollowSymLinks    << 주석
 332     Options FollowSymLinks            << 추가
```

![2022-11-01-06적용확인](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-06적용확인.jpg)

<br>

<br>

<br>

##### File Download

![2022-11-01-07파일다운](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-07파일다운.jpg)

<br>

취약점 1

![2022-11-01-08취약점1](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-08취약점1.jpg)

<br>

취약점 2

![2022-11-01-09취약점2](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-09취약점2.jpg)

```
[root@localhost html]# ls -al /var/www/html/board/upload/
합계 8
drwxr-xr-x 2 root root 4096 2016-12-31 18:08 .
drwxr-xr-x 3 root root 4096 2022-11-02 04:29 ..
test.txt 파일이 upload되지 않음

파일 업로드 쪽 디렉터리 퍼미션을 777 
[root@localhost html]# chmod 777 /var/www/html/board/upload/
[root@localhost html]# ls -ld /var/www/html/board/upload/
drwxrwxrwx 2 root root 4096 2016-12-31 18:08 /var/www/html/board/upload/
```

<br>

다시 업로드 시도

![2022-11-01-11취약점2](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-11취약점2.jpg)

```
[root@localhost html]# ls -al /var/www/html/board/upload/
합계 12
drwxrwxrwx 2 root   root   4096 2022-11-02 05:13 .
drwxr-xr-x 3 root   root   4096 2022-11-02 04:29 ..
-rw-r--r-- 1 apache apache    8 2022-11-02 05:13 test.txt       << 파일 업로드 완료

이 게시글을 쓰는 사용자 계정이 root가 아닌 apache계정 이므로
퍼미션을 부여해 줘야 합니다.
```

<br>

웹 서버 디렉터리 구조

```
웹서버 디렉터리 구조
/var/www/html/index.php

/var/www/html/member/member~~~.php

/var/www/html/board/board~~~.php
/var/www/html/board/upload/test.txt 

../../index.php -> Directory Traversal 
```

<br>

업로드 확인 > 다운로드

게시판에서 파일 다운로드 클릭후 paros 에서 확인

![2022-11-01-13취약점2](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-13취약점2.jpg)

![2022-11-01-14취약점2](../images/2022-11-01-애플리케이션 공격 유형2/2022-11-01-14취약점2.jpg)

<br>

