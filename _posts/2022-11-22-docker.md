# docker

- APPLICATION 실행에 필요한 환경을 하나의 image 로 생성
  - 이미지를 이용하여 다양한 환경에서 실행
  - Docker 만 설치할수 있으면 어떤 OS 환경에서도 동일한 환경의 어플리케이션을 실행 가능

<br>

docker 실행 환경 확인

![2022-11-22-02시스템인포](../images/2022-11-22-docker/2022-11-22-02시스템인포.jpg)

<br>

docker의 저장소 사용 확인

![2022-11-22-03시스템df](../images/2022-11-22-docker/2022-11-22-03시스템df.jpg)

<br>

<br>

<br>

##### docker : container

docker 실행 해보기

![2022-11-22-01헬로월드](../images/2022-11-22-docker/2022-11-22-01헬로월드.jpg)

<br>

docker  image pull(가져오기)

![2022-11-22-04다운](../images/2022-11-22-docker/2022-11-22-04다운.jpg)

<br>

image pull(가져오기) 후 목록 확인

![2022-11-22-05이미지확인](../images/2022-11-22-docker/2022-11-22-05이미지확인.jpg)

<br>

pull 한 docker image 을 기반으로 container 를 run(실행)

![2022-11-22-06실행](../images/2022-11-22-docker/2022-11-22-06실행.jpg)

<br>

웹브라우저에서 컨테이너의 run(실행) 여부 확인 (ubuntu 20.04)

![2022-11-22-07확인](../images/2022-11-22-docker/2022-11-22-07확인.jpg)

![2022-11-22-08확인](../images/2022-11-22-docker/2022-11-22-08확인.jpg)

<br>

남아있는 container 목록 확인

![2022-11-22-09status](../images/2022-11-22-docker/2022-11-22-09status.jpg)

<br>

container 중지

![2022-11-22-10삭제](../images/2022-11-22-docker/2022-11-22-10삭제.jpg)

<br>

container 재시작

![2022-11-22-11재시작](../images/2022-11-22-docker/2022-11-22-11재시작.jpg)

<br>

container ID 사용해서 정지

![2022-11-22-12중지](../images/2022-11-22-docker/2022-11-22-12중지.jpg)

<br>

container 삭제

![2022-11-22-13삭제](../images/2022-11-22-docker/2022-11-22-13삭제.jpg)

<br>

image 검색

![2022-11-22-14검색](../images/2022-11-22-docker/2022-11-22-14검색.jpg)

<br>

centos7 image 설치

![2022-11-22-15설치](../images/2022-11-22-docker/2022-11-22-15설치.jpg)

<br>

nginx 다시 설치

![2022-11-22-16설치](../images/2022-11-22-docker/2022-11-22-16설치.jpg)

<br>

image run

![2022-11-22-19변경](../images/2022-11-22-docker/2022-11-22-19변경.jpg)

<br>

확인

![2022-11-22-20확인](../images/2022-11-22-docker/2022-11-22-20확인.jpg)

<br>

하나의 image로 2개의 container 생성

![2022-11-22-21생성](../images/2022-11-22-docker/2022-11-22-21생성.jpg)

<br>

image 삭제

![2022-11-22-23삭제](../images/2022-11-22-docker/2022-11-22-23삭제.jpg)

<br>

image 모두 삭제

![2022-11-22-24삭제](../images/2022-11-22-docker/2022-11-22-24삭제.jpg)

<br>

container rename

![2022-11-22-25이름변경](../images/2022-11-22-docker/2022-11-22-25이름변경.jpg)

<br>

사용하지 않는 container 를 prune(제거)

![2022-11-22-26삭제](../images/2022-11-22-docker/2022-11-22-26삭제.jpg)

stop되어 있는 모든 container 삭제

<br>

가동중인 container 에 attach(접근)하여 파일을 cp(복사)

![2022-11-22-27도커](../images/2022-11-22-docker/2022-11-22-27도커.jpg)

![2022-11-22-28복사](../images/2022-11-22-docker/2022-11-22-28복사.jpg)

<br>

 docker 를 이용한 mariadb 설치

![2022-11-22-29디비설치](../images/2022-11-22-docker/2022-11-22-29디비설치.jpg)

![2022-11-22-30디비설치](../images/2022-11-22-docker/2022-11-22-30디비설치.jpg)

<br>

<br>

<br>

##### docker : image build

 nginx 의 container 의 html 파일을 추가하여 새로운 image 로 저장 

![2022-11-22-31엔진x](../images/2022-11-22-docker/2022-11-22-31엔진x.jpg)

<br>

![2022-11-22-32엔진x](../images/2022-11-22-docker/2022-11-22-32엔진x.jpg)

<br>

![2022-11-22-33엔진x](../images/2022-11-22-docker/2022-11-22-33엔진x.jpg)

<br>

![2022-11-22-34엔진x](../images/2022-11-22-docker/2022-11-22-34엔진x.jpg)

<br>

![2022-11-22-35엔진x](../images/2022-11-22-docker/2022-11-22-35엔진x.jpg)

<br>

새로 생성된 image 를 reference 하여 새로운 컨테이너를 생성

![2022-11-22-37컨테이너](../images/2022-11-22-docker/2022-11-22-37컨테이너.jpg)

**기존 컨테이너 종료후 새롭게 만들어진 이미지로 컨테이너를 생성하셔야 합니다.**

<br>

새로 생성된 이미지로 컨테이너 생성시 포트번호 다르게 

![2022-11-22-38중복](../images/2022-11-22-docker/2022-11-22-38중복.jpg)

<br>

image backup

![2022-11-22-39백업](../images/2022-11-22-docker/2022-11-22-39백업.jpg)

<br>

<br>

<br>

##### docker : image upload

[hub.docker.com](http://hub.docker.com/) 로그인 -> Repositories -> Create

![2022-11-22-43이미지푸쉬](../images/2022-11-22-docker/2022-11-22-43이미지푸쉬.jpg)

<br>

![2022-11-22-40이미지푸쉬](../images/2022-11-22-docker/2022-11-22-40이미지푸쉬.jpg)

<br>

![2022-11-22-41이미지푸쉬](../images/2022-11-22-docker/2022-11-22-41이미지푸쉬.jpg)

<br>

![2022-11-22-42이미지푸쉬](../images/2022-11-22-docker/2022-11-22-42이미지푸쉬.jpg)

<br>

![2022-11-22-44확인](../images/2022-11-22-docker/2022-11-22-44확인.jpg)

<br>

<br>

<br>

##### docker : build with Dockerfile

###### Dockerfile 편집 I

디렉터리, 파일 만들기

![2022-11-22-45디렉터리파일](../images/2022-11-22-docker/2022-11-22-45디렉터리파일.jpg)

<br>

image build 를 위한 Dockerfile 편집

```
$ sudo vim /home/test01/sample/Dockerfile

FROM centos:latest
```

<br>

작성된 Dockerfile 을 기반으로 image 를 build

![2022-11-22-46빌드](../images/2022-11-22-docker/2022-11-22-46빌드.jpg)

<br>

원본이미지와 사본이미지를 비교

![2022-11-22-47비교](../images/2022-11-22-docker/2022-11-22-47비교.jpg)

이름만 다르고 모든게 똑같다.

<br>

이름이 다른 도커파일 생성

![2022-11-22-48도커](../images/2022-11-22-docker/2022-11-22-48도커.jpg)

<br>

별도 파일명으로 build

![2022-11-22-49빌드](../images/2022-11-22-docker/2022-11-22-49빌드.jpg)

<br>

###### Dockerfile 편집 II

```
vi, ./Dockerfile 

FROM ubuntu:latest
RUN apt-get update && apt-get install -y -q nginx
CMD ["nginx","-g","daemon off;"]
```

<br>

작성된 Dockerfile 을 기반으로 image 를 build

![2022-11-22-50빌드](../images/2022-11-22-docker/2022-11-22-50빌드.jpg)

<br>

Dockerfile backup v1

![2022-11-22-51백업](../images/2022-11-22-docker/2022-11-22-51백업.jpg)

<br>

###### Dockerfile 편집 III

```
vim Dockerfile

FROM centos:latest
RUN echo hi it is shell style
RUN ["echo","hi it is isa exec style"]
RUN ["/bin/bash","-c","echo 'hi it is bash on exec style'"]
```

<br>

image build : run  할때 마다 이미지 생성

![2022-11-22-52빌드](../images/2022-11-22-docker/2022-11-22-52빌드.jpg)

<br>

image 확인

![2022-11-22-53확인](../images/2022-11-22-docker/2022-11-22-53확인.jpg)

<br>

Dockerfile backup v2

![2022-11-22-54백업2](../images/2022-11-22-docker/2022-11-22-54백업2.jpg)

<br>

###### Dockerfile 편집 IV

```
vim Dockerfile

FROM ubuntu:latest
RUN apt-get -y update && apt-get -y upgrade
RUN apt-get -y install nginx
EXPOSE 80                                          << port 번호 지정
CMD ["nginx","-g","daemon off;"]

옵션 안주면 컨테이너를 foreground 에서 실행 할수가 없습니다.
```

<br>

작성된 Dockerfile 을 기반으로 image 를 build

![2022-11-22-55빌드](../images/2022-11-22-docker/2022-11-22-55빌드.jpg)

<br>

image ref 하여 run

![2022-11-22-56런](../images/2022-11-22-docker/2022-11-22-56런.jpg)

![2022-11-22-57확인](../images/2022-11-22-docker/2022-11-22-57확인.jpg)

<br>

<br>

<br>

##### docker : network 

docker network  구조

![2022-11-22-58네트워크](../images/2022-11-22-docker/2022-11-22-58네트워크.jpg)

<br>

 네트워크 드라이버 종류 확인 

```
test01@test01-virtual-machine:~/sample$ sudo docker network inspect bridge

[
    {
        "Name": "bridge",
        "Id": "1bc9a73d2134a70c077c9127de24e950d85070a1e6f8031549ddc01829657293",
        "Created": "2022-11-28T15:34:26.022779349+09:00",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": null,
            "Config": [
                {
                    "Subnet": "172.17.0.0/16",
                    "Gateway": "172.17.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {},
        "Options": {
            "com.docker.network.bridge.default_bridge": "true",
            "com.docker.network.bridge.enable_icc": "true",
            "com.docker.network.bridge.enable_ip_masquerade": "true",
            "com.docker.network.bridge.host_binding_ipv4": "0.0.0.0",
            "com.docker.network.bridge.name": "docker0",
            "com.docker.network.driver.mtu": "1500"
        },
        "Labels": {}
    }
]
```

<br>

image 확인

![2022-11-22-59이미지확인](../images/2022-11-22-docker/2022-11-22-59이미지확인.jpg)

<br>

nginx:latest image 를  reference  하여 container 를 run web_01,web_02

![2022-11-22-60컨터에너](../images/2022-11-22-docker/2022-11-22-60컨터에너.jpg)

<br>

