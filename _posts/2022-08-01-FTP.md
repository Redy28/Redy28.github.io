# FTP

<br>

구상도![2022-08-01-26구상도PNG](../images/2022-08-01-FTP/2022-08-01-26구상도PNG.PNG)

<br>

ftp client 환경구성![2022-08-01-01클라이언트환경구성1](../images/2022-08-01-FTP/2022-08-01-01클라이언트환경구성1.PNG)

![2022-08-01-03클라이언트환경구성3](../images/2022-08-01-FTP/2022-08-01-03클라이언트환경구성3.PNG)

인터페이스 주소를 넣고 알 드라이브를 설치 합니다.

<br>

server 환경구성![2022-08-01-04서버환경구성1](../images/2022-08-01-FTP/2022-08-01-04서버환경구성1.PNG)

<br>

ping 확인![2022-08-01-02클라이언트환경구성2](../images/2022-08-01-FTP/2022-08-01-02클라이언트환경구성2.PNG)

![2022-08-01-05서버환경구성2](../images/2022-08-01-FTP/2022-08-01-05서버환경구성2.PNG)

<br>

server에서 ftp 설치![2022-08-01-06서버환경구성3](../images/2022-08-01-FTP/2022-08-01-06서버환경구성3.PNG)

<br>

server ftp 확인![2022-08-01-08ftp서버접속](../images/2022-08-01-FTP/2022-08-01-08ftp서버접속.PNG)

<br>

client에서 알 드라이브 접속![2022-08-01-07알드라이브접속](../images/2022-08-01-FTP/2022-08-01-07알드라이브접속.PNG)

<br>

Wire Shark로 확인![2022-08-01-09와이어샤크3웨이핸드](../images/2022-08-01-FTP/2022-08-01-09와이어샤크3웨이핸드.PNG)

3way-hand shake : TCP 21 확인 가능

<br>

ktest 로그인 해서 확인 해보기![2022-08-01-10ktest로들어가기](../images/2022-08-01-FTP/2022-08-01-10ktest로들어가기.PNG)

<br>

Wire Shark 확인![2022-08-01-11와이어샤크확인](../images/2022-08-01-FTP/2022-08-01-11와이어샤크확인.PNG)

ID Password가 그대로 드러나는 모습이 보입니다.

보안에 매우 취약한 모습이 그대로 드러나는 모습 입니다.

<br>

root 로그인![2022-08-01-12root로그인](../images/2022-08-01-FTP/2022-08-01-12root로그인.PNG)

로그인이 안되는데 Wire Shark로 확인 해보겠습니다.

<br>

Wire Shark 확인![2022-08-01-13와이어샤크root](../images/2022-08-01-FTP/2022-08-01-13와이어샤크root.PNG)

ktest와 다르게 비밀번호 입력이 되기 전에 막히는 모습 입니다.

root는 기본적으로 접근이 안되게 설정이 되어 있기 때문 입니다.

이제 이 root가 차단되어 있는 곳에 가서 그 설정을 바꾸고 다시 로그인 해 보겠습니다.

<br>

root 차단해제![2022-08-01-16주석처리하는곳](../images/2022-08-01-FTP/2022-08-01-16주석처리하는곳.PNG)

위의 2군데에 들어가서 root를 주석처리 해주시면 됩니다.

<br>

root 주석처리![2022-08-01-14root주석처리](../images/2022-08-01-FTP/2022-08-01-14root주석처리.PNG)

![2022-08-01-15root주석처리2](../images/2022-08-01-FTP/2022-08-01-15root주석처리2.PNG)

<br>

client에서 root 로그인![2022-08-01-18다시root로그인시도](../images/2022-08-01-FTP/2022-08-01-18다시root로그인시도.PNG)

<br>

Wire Shark 확인![2022-08-01-19root로그인성공](../images/2022-08-01-FTP/2022-08-01-19root로그인성공.PNG)

root 차단을 해제하니 로그인이 되는 모습 입니다.

<br>

업로드 다운로드 해보기![2022-08-01-20업로드해보기](../images/2022-08-01-FTP/2022-08-01-20업로드해보기.PNG)

![2022-08-01-21다운로드도 가능](../images/2022-08-01-FTP/2022-08-01-21다운로드도 가능.PNG)

업로드 다운로드 둘 다 성공 했습니다.

root ktest는 다운로드 업로드 둘 다 가능 하지만 익명유저는 업로드는 안되지만 다운로드는 가능 합니다.

<br>

익명유저 파일 만들기![2022-08-01-22익명유저다운로드](../images/2022-08-01-FTP/2022-08-01-22익명유저다운로드.PNG)

`/var/ftp/pub` 가 익명유저가 있는 곳 입니다.

여기서 파일을 하나 만들고 다운로드를 시도 해 보겠습니다.

<br>

익명유저 다운로드![2022-08-01-23익명유저다운로드가능](../images/2022-08-01-FTP/2022-08-01-23익명유저다운로드가능.PNG)

![2022-08-01-24익명유저업로드불가능](../images/2022-08-01-FTP/2022-08-01-24익명유저업로드불가능.PNG)

다운로드는 가능 합니다. 하지만 업로드는 불가능 합니다.

<br>

<br>

<br>

### FTP 연결 방식

ftp 연결 방식은 control connection, data connection 2가지가 있습니다. 

접속할때 control connection (TCP 21)과 data connection (TCP 20) 2번 접속이 됩니다.

control connection (TCP 21)

![2022-08-01-25control](../images/2022-08-01-FTP/2022-08-01-25control.PNG)

data connection (TCP 20) ![2022-08-01-25data](../images/2022-08-01-FTP/2022-08-01-25data.PNG)

각자 다른 포트 번호로 접속하는 모습 입니다.

<br>

data connection은 2가지의 방법이 있습니다.

active, passive 방식이 있는데 구분하는 방법은 3way handshake의 시작점에 따라 달라 집니다.

active는 data connection의 시작점이 server![2022-08-01-27액티브](../images/2022-08-01-FTP/2022-08-01-27액티브.PNG)

passive는 data connection의 시작점이 client 입니다.![2022-08-01-27패시브](../images/2022-08-01-FTP/2022-08-01-27패시브.PNG)

<br>



